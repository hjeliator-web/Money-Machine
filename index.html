<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
 margin:0;
 background:#020824;
 font-family:Arial;
 color:white;
 text-align:center;
}
canvas{
 background:linear-gradient(#06164d,#000);
 display:block;
 margin:auto;
 border:3px solid #00e5ff;
 border-radius:14px;
}
button{
 padding:8px 14px;
 font-size:14px;
 border-radius:8px;
 margin:4px;
}
</style>
</head>

<body>

<h3 id="hud">Loading...</h3>
<canvas id="game" width="360" height="520"></canvas>

<button onclick="moveLeft()">‚¨ÖÔ∏è</button>
<button onclick="shoot()">üî´ FIRE</button>
<button onclick="moveRight()">‚û°Ô∏è</button>
<br>
<button onclick="restart()">üîÑ Restart</button>


<script>
Telegram.WebApp.expand();

// ===== DATA =====
let coins = Number(localStorage.coins || 0);
let level = Number(localStorage.level || 1);
 let difficulty = 1;
let killCount = 0;
let startTime = Date.now();

let lives = 3;
let shield = false;
let rapid = false;
let gameOver = false;

// ===== CANVAS =====
const c = document.getElementById("game");
const x = c.getContext("2d");

// ===== PLAYER =====
let player = {x:160,y:460,speed:6};


// ===== OBJECTS =====
let bullets=[], enemies=[], fallingCoins=[], powerups=[], boss=null;

// ===== HUD =====
function updateHUD(){
 document.getElementById("hud").innerText =
 `ü™ô ${coins} | ‚ù§Ô∏è ${lives} | ‚≠ê Level ${level}` +
 (shield?" | üõ°Ô∏è":"") + (rapid?" | üî•":"");
}
updateHUD();

// ===== SHOOT =====
function shoot(){
 if(gameOver) return;
 bullets.push({x:player.x+12,y:player.y});
}
function moveLeft(){
 if(player.x > 0) player.x -= player.speed;
}

function moveRight(){
 if(player.x < 330) player.x += player.speed;
}

// RAPID FIRE
setInterval(()=>{ if(rapid && !gameOver) shoot(); },200);

// ===== SPAWNS =====
function spawnEnemy(){
 function spawnEnemy(){
 updateDifficulty();
let typeRand = Math.random() + difficulty * 0.03;

 let enemy;

 if(typeRand < 0.25){
  enemy = {type:"normal", icon:"üöÅ", hp:1, x:Math.random()*320, y:-40, speed:2 + difficulty * 0.3
};
 }
 else if(typeRand < 0.45){
  enemy = {type:"fast", icon:"‚úàÔ∏è", hp:1, x:Math.random()*320, y:-40, speed:4};
 }
 else if(typeRand < 0.65){
  enemy = {type:"tank", icon:"üõ∏", hp:3, x:Math.random()*320, y:-40, speed:1.5};
 }
 else if(typeRand < 0.85){
  enemy = {type:"zigzag", icon:"üêù", hp:2, x:Math.random()*320, y:-40, speed:2, dir:1};
 }
 else{
  enemy = {type:"bomber", icon:"üí£", hp:1, x:Math.random()*320, y:-40, speed:2.5};
 }

 enemies.push(enemy);
}

function spawnCoin(){
 fallingCoins.push({x:Math.random()*320,y:-20});
}
function spawnPower(){
 powerups.push({
  x:Math.random()*320,y:-30,
  type:Math.random()>0.5?"shield":"rapid"
 });
}
function spawnBoss(){
 boss={x:120,y:-80,hp:20+level*5};
}

// ===== LOOP =====
function loop(){
 x.clearRect(0,0,360,520);

 // PLAYER
 x.font="32px Arial";
 x.fillText("üõ°Ô∏è",player.x,player.y);

 // BULLETS
 bullets.forEach((b,i)=>{
  b.y-=8;
  x.font="18px Arial";
  x.fillText("üî•",b.x,b.y);
  if(b.y<0) bullets.splice(i,1);
 });

 // ENEMIES
enemies.forEach((e,i)=>{

 // movement
 e.y += e.speed;

 if(e.type==="zigzag"){
  e.x += 2 * e.dir;
  if(e.x<0 || e.x>330) e.dir *= -1;
 }

 x.font="26px Arial";
 x.fillText(e.icon,e.x,e.y);

  if(e.y>440){
 enemies.splice(i,1);

 if(e.type==="bomber"){
  lives -= 2;
 }else if(!shield){
  lives--;
 }

 if(lives<=0) endGame();
}

    

  bullets.forEach((b,bi)=>{
   if(Math.abs(b.x-e.x)<25 && Math.abs(b.y-e.y)<25){
   e.hp--;
bullets.splice(bi,1);

if(e.hp<=0){
killCount++;
 enemies.splice(i,1);

 // bomber explosion bonus
 if(e.type==="bomber"){
  lives--;
 }

 coins += (e.type==="tank"?15:5);
 updateHUD();
}
document.getElementById("hud").innerText =
`ü™ô ${coins} | ‚ù§Ô∏è ${lives} | ‚≠ê Level ${level} | ü§ñ AI ${difficulty}`;

    updateHUD();
   }
  });
 });

 // COINS
 fallingCoins.forEach((c1,i)=>{
  c1.y+=2;
  x.font="20px Arial";
  x.fillText("ü™ô",c1.x,c1.y);
  if(c1.y>450){
   coins++;
   fallingCoins.splice(i,1);
   updateHUD();
  }
 });

 // POWERUPS
 powerups.forEach((p,i)=>{
  p.y+=2;
  x.font="22px Arial";
  x.fillText(p.type==="shield"?"üõ°Ô∏è":"üî•",p.x,p.y);
  if(p.y>450){
   if(p.type==="shield"){
    shield=true;
    setTimeout(()=>shield=false,5000);
   }else{
    rapid=true;
    setTimeout(()=>rapid=false,5000);
   }
   powerups.splice(i,1);
  }
 });

 // BOSS
 if(boss){
  boss.y+=1;
  x.font="40px Arial";
  x.fillText("üëæ",boss.x,boss.y);

  bullets.forEach((b,bi)=>{
   if(Math.abs(b.x-boss.x)<40 && Math.abs(b.y-boss.y)<40){
    boss.hp--;
    bullets.splice(bi,1);
    if(boss.hp<=0){
     coins+=100;
     boss=null;
     level++;
     updateHUD();
    }
   }
  });

  if(boss.y>430){
   endGame();
  }
 }

 if(!gameOver) requestAnimationFrame(loop);
}

// ===== GAME OVER =====
function endGame(){
 gameOver=true;
 alert("üíÄ GAME OVER");
 localStorage.coins=coins;
 localStorage.level=level;
}

// ===== RESTART =====
function restart(){
 lives=3;
 enemies=[];
 bullets=[];
 fallingCoins=[];
 powerups=[];
 boss=null;
 gameOver=false;
 updateHUD();
 loop();
}

// ===== INTERVALS =====
setInterval(()=>{ if(!gameOver) spawnEnemy(); },1000);
setInterval(()=>{ if(!gameOver) spawnCoin(); },800);
setInterval(()=>{ if(!gameOver && Math.random()>0.7) spawnPower(); },6000);
setInterval(()=>{ if(!gameOver && !boss) spawnBoss(); },30000);

// START
loop();



let touchX = null;

c.addEventListener("touchstart", e=>{
 touchX = e.touches[0].clientX;
});

c.addEventListener("touchmove", e=>{
 if(touchX===null) return;
 let newX = e.touches[0].clientX;
 let diff = newX - touchX;
 player.x += diff * 0.15;
 if(player.x<0) player.x=0;
 if(player.x>330) player.x=330;
 touchX = newX;
});

 document.addEventListener("keydown", e=>{
 if(e.key==="ArrowLeft") moveLeft();
 if(e.key==="ArrowRight") moveRight();
 if(e.key===" ") shoot();
});

function updateDifficulty(){
 let timePlayed = Math.floor((Date.now() - startTime)/1000);

 difficulty = 1
  + Math.floor(timePlayed / 30)   // harder every 30 sec
  + Math.floor(killCount / 10)    // harder every 10 kills
  + Math.floor(level / 2);        // harder with level

 if(difficulty > 10) difficulty = 10;
}









 
</script>

</body>
</html>
