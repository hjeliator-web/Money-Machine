<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
 margin:0;
 background:linear-gradient(#6ec6ff,#e0f7fa);
 font-family:Arial;
 text-align:center;
}
canvas{
 background:linear-gradient(#9adfff,#ffffff);
 border-radius:12px;
 border:3px solid #222;
 display:block;
 margin:auto;
}
#hud{
 font-size:15px;
 font-weight:bold;
 padding:6px;
}
#daily{
 font-size:14px;
 color:#333;
 margin-bottom:5px;
}
button{
 padding:8px 12px;
 margin:3px;
 font-size:14px;
 border-radius:8px;
}
</style>
</head>

<body>

<div id="hud">Loading...</div>
<div id="daily">Checking daily reward...</div>

<canvas id="game" width="360" height="480"></canvas>

<div>
<button onclick="shoot()">üî´ Shoot</button>
<button onclick="claimDaily()">üéÅ Daily</button>
<button onclick="showLeaderboard()">üèÜ Rank</button>
</div>

<script>
// ================= TELEGRAM =================
Telegram.WebApp.expand();
let tg = Telegram.WebApp;
let user = tg.initDataUnsafe.user || {};
let username = user.first_name || "Player";
let userid = user.id || Math.floor(Math.random()*99999);

// ================= GAME DATA =================
let coins = Number(localStorage.coins || 0);
let level = Number(localStorage.level || 1);
let energy = Number(localStorage.energy ?? 10);

// ================= DAILY REWARD =================
let lastClaim = Number(localStorage.lastClaim || 0);
let streak = Number(localStorage.streak || 0);
const DAY = 86400000;

function claimDaily(){
 let now = Date.now();

 if(now - lastClaim < DAY){
  alert("‚è≥ Daily reward not ready yet!");
  return;
 }

 streak++;
 let reward = 50 + (streak * 10);
 coins += reward;

 lastClaim = now;
 localStorage.lastClaim = lastClaim;
 localStorage.streak = streak;
 localStorage.coins = coins;

 alert(`üéÅ Daily Reward!\n+${reward} coins\nüî• Streak: ${streak} days`);
 updateHUD();
}

function updateDailyText(){
 let now = Date.now();
 let diff = DAY - (now - lastClaim);

 if(diff <= 0){
  document.getElementById("daily").innerText =
  `üéÅ Daily reward READY | üî• Streak: ${streak}`;
 }else{
  let h = Math.floor(diff/3600000);
  let m = Math.floor((diff%3600000)/60000);
  document.getElementById("daily").innerText =
  `‚è≥ Next reward in ${h}h ${m}m | üî• Streak: ${streak}`;
 }
}

// ================= LEADERBOARD =================
let board = JSON.parse(localStorage.board || "[]");

function updateBoard(){
 board = board.filter(p=>p.id!==userid);
 board.push({id:userid,name:username,coins:coins});
 board.sort((a,b)=>b.coins-a.coins);
 board = board.slice(0,10);
 localStorage.board = JSON.stringify(board);
}

function showLeaderboard(){
 updateBoard();
 let txt="üèÜ LEADERBOARD\n";
 board.forEach((p,i)=>{
  txt += `${i+1}. ${p.name} - ${p.coins}\n`;
 });
 alert(txt);
}

// ================= HUD =================
function updateHUD(){
 document.getElementById("hud").innerText =
 `üë§ ${username} | ü™ô ${coins} | ‚ö° ${energy} | ‚≠ê ${level}`;
 updateDailyText();
}

// ================= ENERGY =================
setInterval(()=>{
 if(energy < 10){
  energy++;
  localStorage.energy = energy;
  updateHUD();
 }
},60000);

// ================= GAME =================
const c = document.getElementById("game");
const x = c.getContext("2d");

let bullets=[];
let plane={x:-80,y:80,alive:true};

function shoot(){
 if(energy<=0){
  alert("‚ö° No energy!");
  return;
 }
 energy--;
 bullets.push({x:180,y:420});
 localStorage.energy = energy;
 updateHUD();
}

function spawnPlane(){
 plane.x=-80;
 plane.y=60+Math.random()*120;
 plane.alive=true;
}
spawnPlane();

function loop(){
 x.clearRect(0,0,360,480);

 // ground
 x.fillStyle="#4caf50";
 x.fillRect(0,440,360,40);

 // player
 x.font="30px Arial";
 x.fillText("üßë‚ÄçüöÄ",165,420);

 // plane
 if(plane.alive){
  plane.x+=2+level*0.3;
  x.font="30px Arial";
  x.fillText("‚úàÔ∏è",plane.x,plane.y);
  if(plane.x>380) spawnPlane();
 }

 // bullets
 for(let i=bullets.length-1;i>=0;i--){
  bullets[i].y-=7;
  x.font="20px Arial";
  x.fillText("üî•",bullets[i].x,bullets[i].y);

  if(plane.alive &&
     bullets[i].y<plane.y+20 &&
     bullets[i].x>plane.x &&
     bullets[i].x<plane.x+40){

    plane.alive=false;
    bullets.splice(i,1);

    coins+=10;
    if(coins%50===0) level++;

    localStorage.coins = coins;
    updateHUD();
    setTimeout(spawnPlane,800);
  }

  if(bullets[i] && bullets[i].y<0) bullets.splice(i,1);
 }

 requestAnimationFrame(loop);
}

updateHUD();
loop();
</script>

</body>
</html>
