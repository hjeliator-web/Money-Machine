<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine Game</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  body {
    margin: 0;
    background: linear-gradient(#87ceeb, #ffffff);
    font-family: Arial, sans-serif;
    text-align: center;
  }

  canvas {
    background: #cceeff;
    display: block;
    margin: auto;
    border: 2px solid #333;
  }

  #coins {
    font-size: 22px;
    margin: 10px;
    font-weight: bold;
  }

  button {
    padding: 10px 25px;
    font-size: 18px;
    margin: 10px;
    cursor: pointer;
  }
</style>
</head>

<body>

<div id="coins">ðŸª™ Coins: 0</div>
<canvas id="game" width="360" height="500"></canvas>
<button onclick="shoot()">ðŸ”« Shoot</button>

<!-- Sounds -->
<audio id="shootSound" src="https://actions.google.com/sounds/v1/impacts/wood_plank_flicks.ogg"></audio>
<audio id="boomSound" src="https://actions.google.com/sounds/v1/explosions/explosion.ogg"></audio>

<script>
let tg = window.Telegram.WebApp;
tg.expand();

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const shootSound = document.getElementById("shootSound");
const boomSound = document.getElementById("boomSound");

let coins = 0;

// Player
let shooter = { x: 170, y: 420 };

// Plane
let plane = {
  x: -80,
  y: 80,
  alive: true
};

// Bullets
let bullets = [];

// Shoot
function shoot() {
  shootSound.currentTime = 0;
  shootSound.play();
  bullets.push({ x: shooter.x + 10, y: shooter.y });
}

// Game loop
function update() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Ground
  ctx.fillStyle = "#4CAF50";
  ctx.fillRect(0, 450, 360, 50);

  // Shooter
  ctx.font = "30px Arial";
  ctx.fillText("ðŸ§‘â€ðŸš€", shooter.x, shooter.y);

  // Plane
  if (plane.alive) {
    plane.x += 2;
    if (plane.x > 400) plane.x = -80;
    ctx.font = "32px Arial";
    ctx.fillText("âœˆï¸", plane.x, plane.y);
  }

  // Bullets
  ctx.font = "20px Arial";
  for (let i = bullets.length - 1; i >= 0; i--) {
    bullets[i].y -= 6;
    ctx.fillText("ðŸ’¥", bullets[i].x, bullets[i].y);

    // Hit detection
    if (
      plane.alive &&
      bullets[i].y < plane.y + 25 &&
      bullets[i].x > plane.x &&
      bullets[i].x < plane.x + 40
    ) {
      boomSound.currentTime = 0;
      boomSound.play();

      plane.alive = false;
      coins += 10;
      document.getElementById("coins").innerText = "ðŸª™ Coins: " + coins;

      setTimeout(() => {
        plane.x = -80;
        plane.alive = true;
      }, 1200);

      bullets.splice(i, 1);
    }

    if (bullets[i] && bullets[i].y < 0) {
      bullets.splice(i, 1);
    }
  }

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>
