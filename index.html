<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine Game</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;background:#020824;color:#fff;font-family:Arial;text-align:center;padding-top:55px}
#topBar{position:fixed;top:0;left:0;right:0;background:#081b4b;padding:6px;display:flex;justify-content:center;gap:8px;z-index:1000}
canvas{display:block;margin:auto;background:linear-gradient(#081b4b,#000);border:3px solid #00e5ff;border-radius:14px}
button{padding:10px 14px;border-radius:10px;font-size:14px}
#hud{padding:6px;font-weight:bold}
#controls{position:fixed;bottom:10px;left:0;right:0;display:flex;justify-content:center;gap:30px;z-index:1000}
.ctrl{width:90px;height:60px;font-size:28px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:2000}
.box{background:#081b4b;padding:20px;border-radius:12px;width:280px}
#bossHP{height:10px;background:#400;margin:6px;border-radius:6px;overflow:hidden;display:none}
#bossHP div{height:100%;background:red;width:100%}
</style>
</head>

<body>

<div id="topBar">
 <button onclick="watchAd()">ğŸ Reward</button>
 <button onclick="openShop()">ğŸ›’ Shop</button>
 <button onclick="openSettings()">âš™ï¸ Settings</button>
</div>

<div id="hud"></div>
<div id="bossHP"><div id="bossBar"></div></div>

<canvas id="game" width="360" height="520"></canvas>

<button onclick="shoot()">ğŸ”« FIRE</button>

<div id="controls">
 <button class="ctrl" ontouchstart="moveLeft=true" ontouchend="moveLeft=false">â¬…ï¸</button>
 <button class="ctrl" ontouchstart="moveRight=true" ontouchend="moveRight=false">â¡ï¸</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="overlay">
 <div class="box">
  <h3>âš™ï¸ SETTINGS</h3>
  ğŸš Sensitivity<br>
  <input type="range" min="0.2" max="1" step="0.1" id="sens"><br>
  <span id="sensVal"></span><br><br>
  <button onclick="closeSettings()">â–¶ Resume</button>
 </div>
</div>

<!-- SHOP -->
<div id="shop" class="overlay">
 <div class="box">
  <h3>ğŸ›’ SHOP</h3>
  <button onclick="buySpeed()">Speed + (50ğŸª™)</button><br><br>
  <button onclick="buyLife()">Extra Life (100ğŸª™)</button><br><br>
  <button onclick="closeShop()">âŒ Close</button>
 </div>
</div>

<script>
Telegram.WebApp.expand();

// STORAGE
let coins=Number(localStorage.coins||0);
let best=Number(localStorage.best||0);
let sensitivity=Number(localStorage.sensitivity||0.7);

// GAME STATE
let lives=3,paused=false,gameOver=false;
let level=1,kills=0;

// PLAYER
let player={x:160,y:460};
let moveLeft=false,moveRight=false;
let speedBoost=1;

// OBJECTS
let bullets=[],enemies=[],fallingCoins=[];
let boss=null;

const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

// HUD
function hud(){
 document.getElementById("hud").innerText=
 `ğŸª™ ${coins} | â¤ï¸ ${lives} | ğŸ† ${best} | â­ Level ${level}`;
}
hud();

// INPUT
document.addEventListener("keydown",e=>{
 if(e.key==="ArrowLeft")moveLeft=true;
 if(e.key==="ArrowRight")moveRight=true;
});
document.addEventListener("keyup",e=>{
 if(e.key==="ArrowLeft")moveLeft=false;
 if(e.key==="ArrowRight")moveRight=false;
});

// SHOOT
function shoot(){
 if(gameOver||paused)return;
 bullets.push({x:player.x+12,y:player.y});
}

// SPAWN NORMAL ENEMIES (STOP AT BOSS)
setInterval(()=>{
 if(paused||gameOver||boss)return;
 enemies.push({x:Math.random()*320,y:-30,s:2+level*0.3});
},900);

// COINS
setInterval(()=>{
 if(!paused&&!gameOver)fallingCoins.push({x:Math.random()*320,y:-20});
},1200);

// BOSS SPAWN
function spawnBoss(){
 boss={x:140,y:60,hp:200+level*20};
 document.getElementById("bossHP").style.display="block";
 updateBossHP();
}

// LOOP
function loop(){
 if(paused||gameOver)return;
 ctx.clearRect(0,0,360,520);

 // MOVE PLAYER
 if(moveLeft)player.x-=6*sensitivity*speedBoost;
 if(moveRight)player.x+=6*sensitivity*speedBoost;
 player.x=Math.max(0,Math.min(330,player.x));

 ctx.font="32px Arial";
 ctx.fillText("ğŸ›¡ï¸",player.x,player.y);

 // BULLETS
 bullets.forEach(b=>{b.y-=10;ctx.font="18px Arial";ctx.fillText("ğŸ”¥",b.x,b.y)});
 bullets=bullets.filter(b=>b.y>0);

 // ENEMIES
 enemies.forEach(e=>{
  e.y+=e.s;
  ctx.font="26px Arial";
  ctx.fillText("âœˆï¸",e.x,e.y);
  bullets.forEach((b,i)=>{
   if(Math.abs(b.x-e.x)<25&&Math.abs(b.y-e.y)<25){
    enemies.splice(enemies.indexOf(e),1);
    bullets.splice(i,1);
    kills++;coins+=5;
    if(kills%20===0)level++;
    if(level===10&&!boss)spawnBoss();
    best=Math.max(best,coins);
    localStorage.best=best;
    hud();
   }
  });
 });

 enemies=enemies.filter(e=>{
  if(e.y>460){lives--;hud();return false}
  return true;
 });

 // BOSS
 if(boss){
  ctx.font="50px Arial";
  ctx.fillText("ğŸ‘¹",boss.x,boss.y);
  bullets.forEach((b,i)=>{
   if(Math.abs(b.x-boss.x)<50&&Math.abs(b.y-boss.y)<50){
    bullets.splice(i,1);
    boss.hp--;
    updateBossHP();
    if(boss.hp<=0){
     boss=null;
     document.getElementById("bossHP").style.display="none";
     coins+=100;
     hud();
    }
   }
  });
 }

 // COINS
 fallingCoins.forEach(c=>{
  c.y+=2;
  ctx.font="20px Arial";
  ctx.fillText("ğŸª™",c.x,c.y);
 });
 fallingCoins=fallingCoins.filter(c=>{
  if(c.y>460){coins++;hud();return false}
  return true;
 });

 if(lives<=0){
  gameOver=true;
  localStorage.coins=coins;
  alert("ğŸ’€ GAME OVER");
 }

 requestAnimationFrame(loop);
}
loop();

// BOSS HP BAR
function updateBossHP(){
 document.getElementById("bossBar").style.width=(boss.hp/250*100)+"%";
}

// SETTINGS / SHOP / REWARD
function openSettings(){paused=true;settings.style.display="flex"}
function closeSettings(){paused=false;settings.style.display="none";loop()}
function openShop(){paused=true;shop.style.display="flex"}
function closeShop(){paused=false;shop.style.display="none";loop()}
function buySpeed(){if(coins>=50){coins-=50;speedBoost+=0.2;hud()}}
function buyLife(){if(coins>=100){coins-=100;lives++;hud()}}
function watchAd(){alert("ğŸ +20 coins");coins+=20;hud()}

// SENSITIVITY
sens.value=sensitivity;
sensVal.innerText=sensitivity;
sens.oninput=()=>{
 sensitivity=Number(sens.value);
 localStorage.sensitivity=sensitivity;
 sensVal.innerText=sensitivity;
};
</script>

</body>
</html>
