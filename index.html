<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine â€“ Survival Shooter</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
 margin:0;
 background:#020824;
 color:white;
 font-family:Arial;
 text-align:center;
}
canvas{
 display:block;
 margin:auto;
 background:linear-gradient(#081b4b,#000);
 border:3px solid #00e5ff;
 border-radius:14px;
}
button{
 padding:10px 14px;
 font-size:14px;
 border-radius:8px;
 margin:4px;
}
#hud{padding:6px;font-weight:bold;}
</style>
</head>

<body>

<div id="hud">Loading...</div>

<canvas id="game" width="360" height="520"></canvas>

<div>
<button onclick="moveLeft()">â¬…ï¸</button>
<button onclick="shoot()">ğŸ”« FIRE</button>
<button onclick="moveRight()">â¡ï¸</button><br>
<button onclick="restart()">ğŸ”„ Restart</button>
</div>

<script>
// ================= TELEGRAM =================
Telegram.WebApp.expand();

// ================= GAME STATE =================
let coins = Number(localStorage.coins || 0);
let level = Number(localStorage.level || 1);
let lives = 3;
let gameOver = false;

// ================= AI DIFFICULTY =================
let difficulty = 1;
let killCount = 0;
let startTime = Date.now();

// ================= CANVAS =================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ================= PLAYER =================
let player = { x:160, y:460, speed:6 };

// ================= OBJECTS =================
let bullets = [];
let enemies = [];
let fallingCoins = [];
let powerups = [];
let boss = null;

// ================= HUD =================
function updateHUD(){
 document.getElementById("hud").innerText =
 `ğŸª™ ${coins} | â¤ï¸ ${lives} | â­ Level ${level} | ğŸ¤– AI ${difficulty}`;
}
updateHUD();

// ================= CONTROLS =================
function moveLeft(){
 if(player.x > 0) player.x -= player.speed;
}
function moveRight(){
 if(player.x < 330) player.x += player.speed;
}
document.addEventListener("keydown", e=>{
 if(e.key==="ArrowLeft") moveLeft();
 if(e.key==="ArrowRight") moveRight();
 if(e.key===" ") shoot();
});

// ================= SHOOT =================
function shoot(){
 if(gameOver) return;
 bullets.push({ x: player.x+12, y: player.y });
}

// ================= DIFFICULTY UPDATE =================
function updateDifficulty(){
 let timePlayed = (Date.now() - startTime)/1000;
 difficulty = Math.min(
  10,
  1 + Math.floor(timePlayed/30) + Math.floor(killCount/10)
 );
}
setInterval(updateDifficulty,2000);

// ================= SPAWN ENEMY =================
function spawnEnemy(){
 let r = Math.random();
 let enemy = {
  type:"normal",
  icon:"ğŸš",
  hp:1,
  x:Math.random()*320,
  y:-40,
  speed:2 + difficulty*0.3,
  dir:1
 };
 if(r>0.85){
  enemy.type="tank";
  enemy.icon="ğŸ›¸";
  enemy.hp=3;
 }
 else if(r>0.65){
  enemy.type="zigzag";
  enemy.icon="ğŸ";
 }
 else if(r>0.45){
  enemy.type="fast";
  enemy.icon="âœˆï¸";
  enemy.speed+=2;
 }
 enemies.push(enemy);
}

// ================= SPAWN COIN =================
function spawnCoin(){
 fallingCoins.push({x:Math.random()*320,y:-20});
}

// ================= SPAWN POWER =================
function spawnPower(){
 powerups.push({
  x:Math.random()*320,
  y:-30,
  type:Math.random()>0.5?"shield":"rapid"
 });
}

// ================= SPAWN BOSS =================
function spawnBoss(){
 boss={x:120,y:-80,hp:20+level*5};
}

// ================= GAME LOOP =================
function loop(){
 ctx.clearRect(0,0,360,520);

 // PLAYER
 ctx.font="32px Arial";
 ctx.fillText("ğŸ›¡ï¸",player.x,player.y);

 // BULLETS
 for(let i=bullets.length-1;i>=0;i--){
  bullets[i].y-=8;
  ctx.font="18px Arial";
  ctx.fillText("ğŸ”¥",bullets[i].x,bullets[i].y);
  if(bullets[i].y<0) bullets.splice(i,1);
 }

 // ENEMIES
 for(let i=enemies.length-1;i>=0;i--){
  let e=enemies[i];
  e.y+=e.speed;

  if(e.type==="zigzag"){
   e.x+=2*e.dir;
   if(e.x<0||e.x>330) e.dir*=-1;
  }

  if(difficulty>5){
   if(e.x<player.x) e.x+=0.5*difficulty;
   if(e.x>player.x) e.x-=0.5*difficulty;
  }

  ctx.font="26px Arial";
  ctx.fillText(e.icon,e.x,e.y);

  if(e.y>440){
   enemies.splice(i,1);
   lives--;
   if(lives<=0){ endGame(); return; }
   continue;
  }

  for(let b=bullets.length-1;b>=0;b--){
   let bl=bullets[b];
   if(Math.abs(bl.x-e.x)<25 && Math.abs(bl.y-e.y)<25){
    bullets.splice(b,1);
    e.hp--;
    if(e.hp<=0){
     killCount++;
     coins+=5;
     enemies.splice(i,1);
     updateHUD();
    }
    break;
   }
  }
 }

 // COINS
 for(let i=fallingCoins.length-1;i>=0;i--){
  fallingCoins[i].y+=2;
  ctx.font="20px Arial";
  ctx.fillText("ğŸª™",fallingCoins[i].x,fallingCoins[i].y);
  if(fallingCoins[i].y>450){
   coins++;
   fallingCoins.splice(i,1);
   updateHUD();
  }
 }

 // POWERUPS
 for(let i=powerups.length-1;i>=0;i--){
  powerups[i].y+=2;
  ctx.font="22px Arial";
  ctx.fillText(powerups[i].type==="shield"?"ğŸ›¡ï¸":"ğŸ”¥",powerups[i].x,powerups[i].y);
  if(powerups[i].y>450){
   powerups.splice(i,1);
  }
 }

 // BOSS
 if(boss){
  boss.y+=1;
  ctx.font="40px Arial";
  ctx.fillText("ğŸ‘¾",boss.x,boss.y);
  for(let b=bullets.length-1;b>=0;b--){
   if(Math.abs(bullets[b].x-boss.x)<40 &&
      Math.abs(bullets[b].y-boss.y)<40){
    bullets.splice(b,1);
    boss.hp--;
    if(boss.hp<=0){
     boss=null;
     coins+=100;
     level++;
     updateHUD();
    }
   }
  }
  if(boss && boss.y>430){ endGame(); return; }
 }

 if(!gameOver) requestAnimationFrame(loop);
}

// ================= GAME OVER =================
function endGame(){
 gameOver=true;
 alert("ğŸ’€ GAME OVER");
 localStorage.coins=coins;
 localStorage.level=level;
}

// ================= RESTART =================
function restart(){
 lives=3;
 enemies=[];
 bullets=[];
 fallingCoins=[];
 powerups=[];
 boss=null;
 gameOver=false;
 updateHUD();
 loop();
}

// ================= INTERVALS =================
setInterval(()=>{ if(!gameOver) spawnEnemy(); },1000);
setInterval(()=>{ if(!gameOver) spawnCoin(); },800);
setInterval(()=>{ if(!gameOver && Math.random()>0.7) spawnPower(); },6000);
setInterval(()=>{ if(!gameOver && !boss) spawnBoss(); },30000);

// START
loop();
</script>

</body>
</html>
