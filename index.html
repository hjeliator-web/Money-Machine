<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine Shooter</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
 margin:0;
 background:#020824;
 color:white;
 font-family:Arial;
 text-align:center;
}
canvas{
 display:block;
 margin:auto;
 background:linear-gradient(#081b4b,#000);
 border:3px solid #00e5ff;
 border-radius:14px;
}
button{
 padding:8px 12px;
 border-radius:8px;
 margin:4px;
}
#hud{padding:6px;font-weight:bold;}

#joystick{
 width:120px;height:120px;
 background:rgba(255,255,255,0.15);
 border-radius:50%;
 position:fixed;bottom:20px;left:20px;
 touch-action:none;
}
#stick{
 width:50px;height:50px;
 background:#00e5ff;border-radius:50%;
 position:absolute;top:35px;left:35px;
}

/* SETTINGS MENU */
#settings{
 position:fixed;
 inset:0;
 background:rgba(0,0,0,0.85);
 display:none;
 align-items:center;
 justify-content:center;
 z-index:99;
}
#settingsBox{
 background:#081b4b;
 padding:20px;
 border-radius:12px;
 width:280px;
}
</style>
</head>

<body>

<div id="hud"></div>

<canvas id="game" width="360" height="520"></canvas>

<button onclick="shoot()">ğŸ”« FIRE</button>
<button onclick="openSettings()">âš™ï¸ Settings</button>

<div id="joystick"><div id="stick"></div></div>

<!-- SETTINGS MENU -->
<div id="settings">
 <div id="settingsBox">
  <h3>âš™ï¸ SETTINGS</h3>

  ğŸš Sensitivity<br>
  <input type="range" min="0.1" max="0.6" step="0.05"
         id="sensSlider"><br>
  <span id="sensValue"></span><br><br>

  ğŸ”Š Sound:
  <button onclick="toggleSound()">Toggle</button><br><br>

  ğŸ’¾ Reset Progress<br>
  <button onclick="resetProgress()">Reset</button><br><br>

  <button onclick="closeSettings()">â–¶ Resume</button>
 </div>
</div>

<script>
// TELEGRAM
Telegram.WebApp.expand();

// GAME STATE
let coins = Number(localStorage.coins || 0);
let lives = 3;
let gameOver = false;
let paused = false;

// SETTINGS
let sensitivity = Number(localStorage.sensitivity || 0.3);
let soundOn = localStorage.sound !== "off";

// CANVAS
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// PLAYER
let player = { x:160, y:460 };

// OBJECTS
let bullets=[], enemies=[], fallingCoins=[];

// HUD
function updateHUD(){
 document.getElementById("hud").innerText=
 `ğŸª™ ${coins} | â¤ï¸ ${lives}`;
}
updateHUD();

// SHOOT
function shoot(){
 if(gameOver||paused) return;
 bullets.push({x:player.x+12,y:player.y});
}

// SPAWN
setInterval(()=>{if(!paused&&!gameOver)enemies.push({x:Math.random()*320,y:-30,s:2});},1000);
setInterval(()=>{if(!paused&&!gameOver)fallingCoins.push({x:Math.random()*320,y:-20});},1200);

// GAME LOOP
function loop(){
 if(paused||gameOver) return;

 ctx.clearRect(0,0,360,520);
 ctx.font="32px Arial";
 ctx.fillText("ğŸ›¡ï¸",player.x,player.y);

 bullets.forEach(b=>{b.y-=8;ctx.font="18px Arial";ctx.fillText("ğŸ”¥",b.x,b.y);});
 bullets=bullets.filter(b=>b.y>0);

 enemies.forEach(e=>{e.y+=e.s;ctx.font="26px Arial";ctx.fillText("âœˆï¸",e.x,e.y);});
 enemies=enemies.filter(e=>{
  if(e.y>460){lives--;updateHUD();return false;}
  return true;
 });

 fallingCoins.forEach(c=>{c.y+=2;ctx.font="20px Arial";ctx.fillText("ğŸª™",c.x,c.y);});
 fallingCoins=fallingCoins.filter(c=>{
  if(c.y>460){coins++;updateHUD();return false;}
  return true;
 });

 requestAnimationFrame(loop);
}
loop();

// JOYSTICK
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");
let drag=false;

joy.addEventListener("touchstart",()=>drag=true);
joy.addEventListener("touchmove",e=>{
 if(!drag||paused) return;
 let r=joy.getBoundingClientRect();
 let dx=e.touches[0].clientX-r.left-60;
 player.x+=dx*sensitivity;
 if(player.x<0)player.x=0;
 if(player.x>330)player.x=330;
 stick.style.left=(35+dx*0.3)+"px";
});
joy.addEventListener("touchend",()=>{
 drag=false;
 stick.style.left="35px";
});

// SETTINGS MENU FUNCTIONS
function openSettings(){
 paused=true;
 document.getElementById("settings").style.display="flex";
}
function closeSettings(){
 paused=false;
 document.getElementById("settings").style.display="none";
 loop();
}
function toggleSound(){
 soundOn=!soundOn;
 localStorage.sound=soundOn?"on":"off";
 alert("Sound "+(soundOn?"ON":"OFF"));
}
function resetProgress(){
 if(confirm("Reset all data?")){
  coins=0;
  localStorage.clear();
  alert("Reset Done");
 }
}

// SENSITIVITY UI
const s=document.getElementById("sensSlider");
const v=document.getElementById("sensValue");
s.value=sensitivity;
v.innerText=sensitivity;
s.oninput=()=>{
 sensitivity=Number(s.value);
 localStorage.sensitivity=sensitivity;
 v.innerText=sensitivity;
};
</script>

</body>
</html>
