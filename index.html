<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine Shooter</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
 margin:0;
 background:#020824;
 color:white;
 font-family:Arial;
 text-align:center;
}
canvas{
 display:block;
 margin:auto;
 background:linear-gradient(#081b4b,#000);
 border:3px solid #00e5ff;
 border-radius:14px;
}
button{
 padding:8px 12px;
 border-radius:8px;
 margin:4px;
}
#hud{padding:6px;font-weight:bold;}
#joystick{
 width:120px;
 height:120px;
 background:rgba(255,255,255,0.15);
 border-radius:50%;
 position:fixed;
 bottom:20px;
 left:20px;
 touch-action:none;
}
#stick{
 width:50px;
 height:50px;
 background:#00e5ff;
 border-radius:50%;
 position:absolute;
 top:35px;
 left:35px;
}
</style>
</head>

<body>

<div id="hud">Loading...</div>

<canvas id="game" width="360" height="520"></canvas>

<button onclick="shoot()">ğŸ”« FIRE</button>
<button onclick="restart()">ğŸ”„ Restart</button>

<div style="margin-top:8px;">
 ğŸšï¸ Sensitivity
 <input type="range" min="0.1" max="0.6" step="0.05"
        id="sensSlider">
 <span id="sensValue"></span>
</div>

<div id="joystick">
 <div id="stick"></div>
</div>

<script>
// ================= TELEGRAM =================
Telegram.WebApp.expand();

// ================= GAME STATE =================
let coins = Number(localStorage.coins || 0);
let lives = 3;
let gameOver = false;

// ================= SENSITIVITY =================
let sensitivity = Number(localStorage.sensitivity || 0.3);

// ================= AI DIFFICULTY =================
let difficulty = 1;
let killCount = 0;
let startTime = Date.now();

// ================= CANVAS =================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ================= PLAYER =================
let player = { x:160, y:460 };

// ================= OBJECTS =================
let bullets = [];
let enemies = [];
let fallingCoins = [];

// ================= HUD =================
function updateHUD(){
 document.getElementById("hud").innerText =
 `ğŸª™ ${coins} | â¤ï¸ ${lives} | ğŸ¤– AI ${difficulty}`;
}
updateHUD();

// ================= SHOOT =================
function shoot(){
 if(gameOver) return;
 bullets.push({x:player.x+12,y:player.y});
}

// ================= DIFFICULTY =================
setInterval(()=>{
 let timePlayed=(Date.now()-startTime)/1000;
 difficulty=Math.min(10,1+Math.floor(timePlayed/30)+Math.floor(killCount/10));
},2000);

// ================= SPAWN =================
function spawnEnemy(){
 let r=Math.random();
 let e={
  x:Math.random()*320,
  y:-40,
  speed:2+difficulty*0.3,
  hp:1,
  icon:"ğŸš",
  dir:1,
  type:"normal"
 };
 if(r>0.8){e.icon="âœˆï¸";e.speed+=2;}
 else if(r>0.6){e.icon="ğŸ›¸";e.hp=3;}
 else if(r>0.4){e.icon="ğŸ";e.type="zigzag";}
 enemies.push(e);
}
function spawnCoin(){
 fallingCoins.push({x:Math.random()*320,y:-20});
}

// ================= GAME LOOP =================
function loop(){
 ctx.clearRect(0,0,360,520);

 // PLAYER
 ctx.font="32px Arial";
 ctx.fillText("ğŸ›¡ï¸",player.x,player.y);

 // BULLETS
 for(let i=bullets.length-1;i>=0;i--){
  bullets[i].y-=8;
  ctx.font="18px Arial";
  ctx.fillText("ğŸ”¥",bullets[i].x,bullets[i].y);
  if(bullets[i].y<0) bullets.splice(i,1);
 }

 // ENEMIES
 for(let i=enemies.length-1;i>=0;i--){
  let e=enemies[i];
  e.y+=e.speed;
  if(e.type==="zigzag"){
   e.x+=2*e.dir;
   if(e.x<0||e.x>330) e.dir*=-1;
  }
  ctx.font="26px Arial";
  ctx.fillText(e.icon,e.x,e.y);

  if(e.y>440){
   enemies.splice(i,1);
   lives--;
   if(lives<=0){endGame();return;}
   continue;
  }

  for(let b=bullets.length-1;b>=0;b--){
   let bl=bullets[b];
   if(Math.abs(bl.x-e.x)<25&&Math.abs(bl.y-e.y)<25){
    bullets.splice(b,1);
    e.hp--;
    if(e.hp<=0){
     enemies.splice(i,1);
     coins+=5;
     killCount++;
     updateHUD();
    }
    break;
   }
  }
 }

 // COINS
 for(let i=fallingCoins.length-1;i>=0;i--){
  fallingCoins[i].y+=2;
  ctx.font="20px Arial";
  ctx.fillText("ğŸª™",fallingCoins[i].x,fallingCoins[i].y);
  if(fallingCoins[i].y>450){
   coins++;
   fallingCoins.splice(i,1);
   updateHUD();
  }
 }

 if(!gameOver) requestAnimationFrame(loop);
}

// ================= GAME OVER =================
function endGame(){
 gameOver=true;
 alert("ğŸ’€ GAME OVER");
 localStorage.coins=coins;
}

// ================= RESTART =================
function restart(){
 lives=3;
 enemies=[];
 bullets=[];
 fallingCoins=[];
 gameOver=false;
 updateHUD();
 loop();
}

// ================= INTERVALS =================
setInterval(()=>{if(!gameOver)spawnEnemy();},1000);
setInterval(()=>{if(!gameOver)spawnCoin();},900);

// ================= JOYSTICK =================
const joy=document.getElementById("joystick");
const stick=document.getElementById("stick");
let dragging=false;

joy.addEventListener("touchstart",()=>dragging=true);
joy.addEventListener("touchmove",e=>{
 if(!dragging) return;
 let rect=joy.getBoundingClientRect();
 let dx=e.touches[0].clientX-rect.left-60;
 player.x+=dx*sensitivity;
 if(player.x<0)player.x=0;
 if(player.x>330)player.x=330;
 stick.style.left=(35+dx*0.3)+"px";
});
joy.addEventListener("touchend",()=>{
 dragging=false;
 stick.style.left="35px";
});

// ================= SENSITIVITY UI =================
const slider=document.getElementById("sensSlider");
const val=document.getElementById("sensValue");
slider.value=sensitivity;
val.innerText=sensitivity;
slider.oninput=()=>{
 sensitivity=Number(slider.value);
 localStorage.sensitivity=sensitivity;
 val.innerText=sensitivity;
};

// START
loop();
</script>

</body>
</html>
