<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine Game</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{margin:0;background:#020824;color:#fff;font-family:Arial;text-align:center}
canvas{display:block;margin:auto;background:linear-gradient(#081b4b,#000);border:3px solid #00e5ff;border-radius:14px}
button{padding:10px 16px;border-radius:10px;margin:4px;font-size:16px}
#hud{padding:6px;font-weight:bold}

/* MOBILE CONTROLS */
#controls{
 position:fixed;
 bottom:10px;
 left:0;
 right:0;
 display:flex;
 justify-content:center;
 gap:20px;
}
.ctrl{
 width:90px;
 height:60px;
 font-size:28px;
}

/* OVERLAY */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);display:none;align-items:center;justify-content:center;z-index:99}
.box{background:#081b4b;padding:20px;border-radius:12px;width:300px}
</style>
</head>

<body>

<div id="hud"></div>
<canvas id="game" width="360" height="520"></canvas>

<div>
 <button onclick="shoot()">ğŸ”« FIRE</button>
 <button onclick="openSettings()">âš™ï¸ Settings</button>
</div>

<!-- MOBILE LEFT RIGHT -->
<div id="controls">
 <button class="ctrl" ontouchstart="moveLeft=true" ontouchend="moveLeft=false">â¬…ï¸</button>
 <button class="ctrl" ontouchstart="moveRight=true" ontouchend="moveRight=false">â¡ï¸</button>
</div>

<!-- SETTINGS -->
<div id="settings" class="overlay">
 <div class="box">
  <h3>âš™ï¸ SETTINGS</h3>
  ğŸš Sensitivity<br>
  <input type="range" min="0.2" max="1" step="0.1" id="sens"><br>
  <span id="sensVal"></span><br><br>
  <button onclick="closeSettings()">â–¶ Resume</button>
 </div>
</div>

<script>
// TELEGRAM
Telegram.WebApp.expand();

// STORAGE
let coins = Number(localStorage.coins || 0);
let best = Number(localStorage.best || 0);
let sensitivity = Number(localStorage.sensitivity || 0.7);

// GAME STATE
let lives=3,gameOver=false,paused=false;

// PLAYER
let player={x:160,y:460};

// INPUT
let moveLeft=false, moveRight=false;

// OBJECTS
let bullets=[], enemies=[], coinsFall=[];
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

// HUD
function hud(){
 document.getElementById("hud").innerText=
 `ğŸª™ ${coins} | â¤ï¸ ${lives} | ğŸ† ${best}`;
}
hud();

// KEYBOARD
document.addEventListener("keydown",e=>{
 if(e.key==="ArrowLeft") moveLeft=true;
 if(e.key==="ArrowRight") moveRight=true;
});
document.addEventListener("keyup",e=>{
 if(e.key==="ArrowLeft") moveLeft=false;
 if(e.key==="ArrowRight") moveRight=false;
});

// SHOOT
function shoot(){
 if(gameOver||paused) return;
 bullets.push({x:player.x+12,y:player.y});
}

// SPAWN
setInterval(()=>!paused&&!gameOver&&enemies.push({x:Math.random()*320,y:-30,s:2+Math.random()*2}),900);
setInterval(()=>!paused&&!gameOver&&coinsFall.push({x:Math.random()*320,y:-20}),1200);

// LOOP
function loop(){
 if(paused||gameOver) return;
 ctx.clearRect(0,0,360,520);

 // MOVE PLAYER (FAST)
 if(moveLeft) player.x -= 6 * sensitivity;
 if(moveRight) player.x += 6 * sensitivity;
 player.x = Math.max(0, Math.min(330, player.x));

 // DRAW PLAYER
 ctx.font="32px Arial";
 ctx.fillText("ğŸ›¡ï¸",player.x,player.y);

 // BULLETS
 bullets.forEach(b=>{b.y-=10;ctx.font="18px Arial";ctx.fillText("ğŸ”¥",b.x,b.y);});
 bullets=bullets.filter(b=>b.y>0);

 // ENEMIES
 enemies.forEach(e=>{
  e.y+=e.s;
  ctx.font="26px Arial";
  ctx.fillText("âœˆï¸",e.x,e.y);
  bullets.forEach((b,i)=>{
   if(Math.abs(b.x-e.x)<25&&Math.abs(b.y-e.y)<25){
    enemies.splice(enemies.indexOf(e),1);
    bullets.splice(i,1);
    coins+=5;
    best=Math.max(best,coins);
    localStorage.best=best;
    hud();
   }
  });
 });
 enemies=enemies.filter(e=>{
  if(e.y>460){lives--;hud();return false}
  return true;
 });

 // COINS
 coinsFall.forEach(c=>{
  c.y+=2;
  ctx.font="20px Arial";
  ctx.fillText("ğŸª™",c.x,c.y);
 });
 coinsFall=coinsFall.filter(c=>{
  if(c.y>460){coins++;hud();return false}
  return true;
 });

 if(lives<=0){
  gameOver=true;
  localStorage.coins=coins;
  alert("ğŸ’€ GAME OVER");
 }
 requestAnimationFrame(loop);
}
loop();

// SETTINGS
function openSettings(){paused=true;settings.style.display="flex"}
function closeSettings(){paused=false;settings.style.display="none";loop()}

// SENSITIVITY UI
sens.value=sensitivity;
sensVal.innerText=sensitivity;
sens.oninput=()=>{
 sensitivity=Number(sens.value);
 localStorage.sensitivity=sensitivity;
 sensVal.innerText=sensitivity;
};
</script>

</body>
</html>
