<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Money Machine</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body{
 margin:0;
 background:#020824;
 font-family:Arial;
 color:white;
 text-align:center;
}
canvas{
 background:linear-gradient(#06164d,#000);
 display:block;
 margin:auto;
 border:3px solid #00e5ff;
 border-radius:14px;
}
button{
 padding:8px 14px;
 font-size:14px;
 border-radius:8px;
 margin:4px;
}
</style>
</head>

<body>

<h3 id="hud">Loading...</h3>
<canvas id="game" width="360" height="520"></canvas>

<button onclick="shoot()">ðŸ”« FIRE</button>
<button onclick="restart()">ðŸ”„ Restart</button>

<script>
Telegram.WebApp.expand();

// ===== DATA =====
let coins = Number(localStorage.coins || 0);
let level = Number(localStorage.level || 1);
let lives = 3;
let shield = false;
let rapid = false;
let gameOver = false;

// ===== CANVAS =====
const c = document.getElementById("game");
const x = c.getContext("2d");

// ===== PLAYER =====
let player = {x:160,y:460};

// ===== OBJECTS =====
let bullets=[], enemies=[], fallingCoins=[], powerups=[], boss=null;

// ===== HUD =====
function updateHUD(){
 document.getElementById("hud").innerText =
 `ðŸª™ ${coins} | â¤ï¸ ${lives} | â­ Level ${level}` +
 (shield?" | ðŸ›¡ï¸":"") + (rapid?" | ðŸ”¥":"");
}
updateHUD();

// ===== SHOOT =====
function shoot(){
 if(gameOver) return;
 bullets.push({x:player.x+12,y:player.y});
}

// RAPID FIRE
setInterval(()=>{ if(rapid && !gameOver) shoot(); },200);

// ===== SPAWNS =====
function spawnEnemy(){
 enemies.push({x:Math.random()*320,y:-40,speed:2+level*0.3});
}
function spawnCoin(){
 fallingCoins.push({x:Math.random()*320,y:-20});
}
function spawnPower(){
 powerups.push({
  x:Math.random()*320,y:-30,
  type:Math.random()>0.5?"shield":"rapid"
 });
}
function spawnBoss(){
 boss={x:120,y:-80,hp:20+level*5};
}

// ===== LOOP =====
function loop(){
 x.clearRect(0,0,360,520);

 // PLAYER
 x.font="32px Arial";
 x.fillText("ðŸ›¡ï¸",player.x,player.y);

 // BULLETS
 bullets.forEach((b,i)=>{
  b.y-=8;
  x.font="18px Arial";
  x.fillText("ðŸ”¥",b.x,b.y);
  if(b.y<0) bullets.splice(i,1);
 });

 // ENEMIES
 enemies.forEach((e,i)=>{
  e.y+=e.speed;
  x.font="26px Arial";
  x.fillText("ðŸš",e.x,e.y);

  if(e.y>440){
   enemies.splice(i,1);
   if(!shield){
    lives--;
    if(lives<=0){ endGame(); }
   }
  }

  bullets.forEach((b,bi)=>{
   if(Math.abs(b.x-e.x)<25 && Math.abs(b.y-e.y)<25){
    enemies.splice(i,1);
    bullets.splice(bi,1);
    coins+=5;
    updateHUD();
   }
  });
 });

 // COINS
 fallingCoins.forEach((c1,i)=>{
  c1.y+=2;
  x.font="20px Arial";
  x.fillText("ðŸª™",c1.x,c1.y);
  if(c1.y>450){
   coins++;
   fallingCoins.splice(i,1);
   updateHUD();
  }
 });

 // POWERUPS
 powerups.forEach((p,i)=>{
  p.y+=2;
  x.font="22px Arial";
  x.fillText(p.type==="shield"?"ðŸ›¡ï¸":"ðŸ”¥",p.x,p.y);
  if(p.y>450){
   if(p.type==="shield"){
    shield=true;
    setTimeout(()=>shield=false,5000);
   }else{
    rapid=true;
    setTimeout(()=>rapid=false,5000);
   }
   powerups.splice(i,1);
  }
 });

 // BOSS
 if(boss){
  boss.y+=1;
  x.font="40px Arial";
  x.fillText("ðŸ‘¾",boss.x,boss.y);

  bullets.forEach((b,bi)=>{
   if(Math.abs(b.x-boss.x)<40 && Math.abs(b.y-boss.y)<40){
    boss.hp--;
    bullets.splice(bi,1);
    if(boss.hp<=0){
     coins+=100;
     boss=null;
     level++;
     updateHUD();
    }
   }
  });

  if(boss.y>430){
   endGame();
  }
 }

 if(!gameOver) requestAnimationFrame(loop);
}

// ===== GAME OVER =====
function endGame(){
 gameOver=true;
 alert("ðŸ’€ GAME OVER");
 localStorage.coins=coins;
 localStorage.level=level;
}

// ===== RESTART =====
function restart(){
 lives=3;
 enemies=[];
 bullets=[];
 fallingCoins=[];
 powerups=[];
 boss=null;
 gameOver=false;
 updateHUD();
 loop();
}

// ===== INTERVALS =====
setInterval(()=>{ if(!gameOver) spawnEnemy(); },1000);
setInterval(()=>{ if(!gameOver) spawnCoin(); },800);
setInterval(()=>{ if(!gameOver && Math.random()>0.7) spawnPower(); },6000);
setInterval(()=>{ if(!gameOver && !boss) spawnBoss(); },30000);

// START
loop();
</script>

</body>
</html>
